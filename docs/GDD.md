# Game design

## Базовые механики

- Сюжет
- Стрельба и перемещение
- Крафтинг
- Строительство 


## Ключевые механики (killer features)

- Отряд соратников. Вы как персонаж перемещаетесь с отрядом соратников который
  может принимать решения самостоятельно

- Rogue-like реалистичность и сложность. При смерти - вы берете в управление
  другого персонажа (like Ancestors)

- "Live environment" - живой мир. Мир менется со временем, не зависимо от того
  делаете ли вы что-то или нет.


## AI

ИИ одиночного врага должен выполнять следующую логику:
1. Выполнять поиск игрока
2. Если игрок обнаружен (с определенной дистанции), выполнить нападение
3. В случае опасности выполнять отступление

### Поиск 
Поиск осуществляется случайным поиском по 2Д пространству. Бот должен следовать
к самой дальней видимой точке (симуляция реального поведения) и запоминать
какие области он уже просмотрел. Крайне не желательно повторное прохождение уже
изведанных областей.

### Обнаружение и бой
У бота есть область, в которой он может обнаружить игрока. Когда игрок
обнаружен, бот входит в состояние боя. В бою, бот ищет ближайщее укрытие,
которое находится между ним и игроком. Бот перемещается в укрытие и начинает
вести огонь из него.
Бот должен открывать огонь, когда игрок далет перерывы в стрельбе. Если бот
находится под обстрелом, он должен находиться в укрытие и вести не прицельный
ответный огонь.
Бот должен уметь ранжировать ближайшие укрытия по эффективности боя и занимать
лучшую позицию. Бот может сменять укрытие, для выбора более удачной позиции. 
В случае, если у бота закончились патроны, он принимает решение: штурм или
отступление. На решение влияет количество патронов оставшихся у игрока,
местность и дистанция до игрока, а так же характеристики (смелость, скорость и
т.п.) бота.

## Cooling

У игрока есть свойство warm - опысывает насколько он замерз. Уменьшение должно
происходить по таймеру. Скорость замерзания зависит от окружения: погода, в
здании или на улице и т.п. Около костра этот показатель должен наоборот
увеличиваться.

1. Сделать отдельный компонент который управляет значением, знает про окружение
   и знает как изменять значение в зависимости от него. 

## Live Environment

### Live
- НПС - невосполняемый ресурс ограниченного количества
- Менеджеры ресурсов определяют какие задачи будут выполняться
- Менеджеры могут делегировать часть ресурсов под управление другого менеджера
- Задача менеджера - выполнить задачу минимальными потерями
- Изначально, ресурсы имеют распределение по карте
- Смерть игрока приводит к неизвестному концу - требуется выполнение мира до
  завершения
- Концом считается обнуление ресурсов одной из сторон на области мира, занятой
  оппонентом
- Для существования, НПС нужны примитивные ресурсы: еда, вода. Так же
  второстепенные потребности: тепло(одежда, кров), туалет. 
- Отсутствие примитивов ведет к вымеранию НПС.
- Менеджер формирует задания по добыче примитивов для организации комфортного
  проживания НПС.
- Менеджер имеет свои характеристики, которые влиют на принимаемые им решения

### Managment history

Для принятия решений, менеджеру нужна информация. Первая задача, которую ставит
менеджер - поиск информации. Менеджер задает отрядам задачи проведения разведки
в заданных им областях. Менеджер оперирует предположениями для формирования
задач разведки, и в силу недостатка информации, может ставить задачи не совсем
определенные: "найдите где-нибудь на севере что-нибудь полезное". Это оставляет
свободу ИИ НПС для выполнения задачи. 

Предположения могут подтверждаться или опровергаться. В результате выполнения
разведки, полученная информация используется менеджером для формирования более
сложных задач: 
- Договориться с деревней о поставках еды
- Найти новых саратников
- ???

Постепенно у менеджера выстраивается карта обеспечения кампании. В дальнейшем,
по этой карте менеджер строит задания. 

### Question: how handle collecting info with live env?
Как передавать изменяемую информацию? Игрок может пройти по разным путям, а
следовательно получать разную информацию в одних и тех же местах. 
Пример:
1. На юге есть железная дорога. В одной итерации, менеджер дает задачу
   разведать север. События развиваются на севере, кампания попадает на фронт.
   На юге в этот момент проходят поезда врагов, дополняя их ресурсами. Позднее
   менеджер дает задачу исследовать юг, обнаруживается проходящий поезд. Затем
   отправляется операция по диверсии поезда, но в это время лагерь
   уничтожается, кампания проиграна.
2. Во второй раз игрок игнорирует приказ поиска на севере и находит на юге ж/д,
   и сообщает о поездах. Менеджер меняет план на атаку юга, что приводит к
   победе.

#### Варианты
- определение конечного множества возможных событий для конечного множества
  интерактивных областей (деревни, ж/д пути, фронтовые окопы, и т.п.)

### Question: how to determine effective action?
Как менеджер должен по полученной информации создавать новые задачи?

#### Варианты
- Имея конечное множество событий, можно построить дерево реагирования

Можно ли не расматривать все варианты? 

- Использование ML. Генерация датасетов на менеджерах со случайной логикой,
  поиск паттернов (цепочек событий) ведущих к поражению, рассмотрение различных
  моделей.

Что делать с неполной информацией? Модели в большинстве случаев рассматривают
одинаковый набор параметров, а в нам случае он все время пополняется и с каждым
новым событием у нас больше информации. 
:qa

### Possible history: Wolfs assault on camp
- Игрок создает лагерь где-то неподалеку от стаи волков
- Стая волков когда голодна выходит на охоту
- Если стая находит лагерь, происходит оценка сил и шанс победы. Если шанс
  велик - происходит атака
- Если НПС лагеря замечает волков - начинает шум
- Игрок может так же поднять шум
- Другие НПС реагируют на шум и ищут врага. Когда находят атакуют

### Possible history: raid
- НПС врага могут осуществляют поиск партизанских лагерей в разных секторах
- если НПС врага выбирают для поиска серктор с лагерем, то далее повторяется
  история аналогичная истории с волками

### Missions: ending, timing
- Миссии имеют тайминг - время, в которое есть смысл их выполнять
- Миссии должны генерироваться из данных об окружающем мире
- Результат выполнения или невыполнения миссии изменяет окружение, что приводит
  к изменению последующих миссий (их наличие, тип)

### Possible history: mission collapse

Игроку доступна некоторая миссия по уничтожению отряда

### Actions: what AI can do
- АИ имеет ограниченный набор действий

### Behaviour: react and move out

- АИ выполняет поиск лагеря
- Игрок замечает заранее АИ
- Игрок срывает агро на себя и уводит врага от лагеря
- Игрок должен скрыться от преследователей

### Low start

- Менеджер задания точек поиска
- Поиск и нападение единственным НПС

- отряд и совместные действия
- совместное перемещение отряда
- совместное реагирование на угрозы
